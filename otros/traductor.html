<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DFX Translate</title>
<link rel="stylesheet" href="/style.css">
<style>
  .traductor-container {
    max-width: 900px;
    margin: 60px auto;
    padding: 20px;
    padding-top: 60px;
  }

  .traductor-card {
    padding: 24px;
    border-radius: 20px;
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.4), 0 4px 16px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.1);
  }

  .traductor-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
  }

  .traductor-col {
    flex: 1;
    min-width: 300px;
    display: flex;
    flex-direction: column;
  }

  .traductor-col label {
    margin-bottom: 8px;
    color: var(--text-color);
  }

  select {
    background: var(--bg-color);
    font-family: 'Gabarito', sans-serif;
    border: 2px solid var(--link-hover);
    border-radius: 16px;
    padding: 12px;
    font-size: 1rem;
    color: var(--text-color);
    margin-bottom: 15px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  textarea {
    background: var(--bg-color);
    font-family: 'Gabarito', sans-serif;
    border: 2px solid var(--link-hover);
    border-radius: 16px;
    padding: 12px;
    font-size: 1rem;
    color: var(--text-color);
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  select:focus, textarea:focus {
    border-color: var(--link-hover);
    outline: none;
  }

  .traductor-btn {
    background: linear-gradient(135deg, var(--link-hover) 0%, var(--link-hover2) 100%);
    color: var(--text-color);
    border: none;
    border-radius: 16px;
    padding: 12px 24px;
    font-family: 'Gabarito', sans-serif;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    outline: 2px solid rgba(255, 255, 255, 0.1);
    margin: 20px auto;
    display: block;
  }

  .traductor-btn:hover {
    box-shadow: 0 6px 12px var(--link-hover);
    outline: 2px solid var(--link-hover);
  }

  .auto-label {
    font-size: 0.8rem;
    color: var(--text-color);
    margin-top: 4px;
  }

  #loadingOverlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    font-family: sans-serif;
  }
</style>
</head>
<body>
  <div id="topnav-container"></div>

  <div id="loadingOverlay">Traduciendo...</div>

  <div class="traductor-container">
    <h1>DFX Translate (WIP)</h1>
    <div class="traductor-card">
      <div class="traductor-row">
        <div class="traductor-col">
          <label for="sourceLang">Origen</label>
          <select id="sourceLang">
            <option value="auto" selected>Detectar automáticamente</option>
            <option value="en">Inglés</option>
            <option value="es">Español</option>
            <option value="fr">Francés</option>
            <option value="de">Alemán</option>
            <option value="it">Italiano</option>
            <option value="pt">Portugués</option>
            <option value="ru">Ruso</option>
            <option value="zh">Chino</option>
          </select>

          <label for="inputText">Texto</label>
          <textarea id="inputText" placeholder="Introduce texto aquí"></textarea>
        </div>

        <div class="traductor-col">
          <label for="targetLang">Destino</label>
          <select id="targetLang">
            <option value="es">Español</option>
            <option value="en" selected>Inglés</option>
            <option value="fr">Francés</option>
            <option value="de">Alemán</option>
            <option value="it">Italiano</option>
            <option value="pt">Portugués</option>
            <option value="ru">Ruso</option>
            <option value="zh">Chino</option>
          </select>

          <label for="outputText">Traducción</label>
          <textarea id="outputText" readonly></textarea>
        </div>
      </div>
          <div class="auto-label" id="detectedLang"></div>
      <button id="translateBtn" class="traductor-btn">Traducir</button>
    </div>
  </div>

<script src="/loader.js"></script>
<script>
const PROXY = "https://corsproxy.io/?";
const API = "https://libretranslate.de";

const translateBtn = document.getElementById("translateBtn");
const inputText = document.getElementById("inputText");
const outputText = document.getElementById("outputText");
const sourceLang = document.getElementById("sourceLang");
const targetLang = document.getElementById("targetLang");
const overlay = document.getElementById("loadingOverlay");
const detectedLang = document.getElementById("detectedLang");

async function detectLanguage(text) {
  try {
    const res = await fetch(PROXY + API + "/detect", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ q: text })
    });
    const data = await res.json();
    return data[0]?.language || null;
  } catch (err) {
    console.warn("No se pudo detectar el idioma:", err.message);
    return null;
  }
}

translateBtn.addEventListener("click", async () => {
  const text = inputText.value.trim();
  if (!text) return alert("Por favor, escribe un texto para traducir.");

  overlay.style.display = "flex";
  outputText.value = "";
  detectedLang.textContent = "";

  try {
    let srcLang = sourceLang.value;
    if (srcLang === "auto") {
      const lang = await detectLanguage(text);
      srcLang = lang || "en";
      detectedLang.textContent = `Detectado: ${lang?.toUpperCase() || "Desconocido"}`;
    }

    const res = await fetch(PROXY + API + "/translate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        q: text,
        source: srcLang,
        target: targetLang.value,
        format: "text"
      })
    });

    const data = await res.json();
    outputText.value = data.translatedText || "(sin resultado)";
  } catch (err) {
    console.error("Error en traducción:", err);
    outputText.value = `Error: ${err.message}`;
  } finally {
    overlay.style.display = "none";
  }
});
</script>
</body>
</html>
